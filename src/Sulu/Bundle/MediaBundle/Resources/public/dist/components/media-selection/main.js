define(function(){"use strict";var a={eventNamespace:"sulu.media-selection",thumbnailKey:"thumbnails",thumbnailSize:"50x50",resultKey:"media",dataAttribute:"media-selection",actionIcon:"fa-file-image-o",types:null,navigateEvent:"sulu.router.navigate",dataDefault:{displayOption:"top",ids:[]},hideConfigButton:!0,translations:{noContentSelected:"media-selection.nomedia-selected",addImages:"media-selection.add-images",choose:"public.choose",collections:"media-selection.collections",upload:"media-selection.upload-new",collection:"media-selection.upload-to-collection",createNewCollection:"media-selection.create-new-collection",newCollection:"media-selection.new-collection"}},b=function(){return c.call(this,"record-deselected")},c=function(a){return this.options.eventNamespace+"."+(this.options.instanceName?this.options.instanceName+".":"")+a},d={contentItem:function(a,b,c,d){return['<a href="#" class="link" data-id="',a,'" data-collection="',b,'">','    <img src="',d["50x50"],'"/>','    <span class="title">',c,"</span>","</a>"].join("")}},e=function(){this.sandbox.on(this.DISPLAY_OPTION_CHANGED(),function(a){h.call(this,{displayOption:a},!1)},this),this.sandbox.on(this.DATA_RETRIEVED(),function(a){var b=[];this.sandbox.util.foreach(a,function(a){b.push(a.id)}.bind(this)),h.call(this,{ids:b},!1)},this),this.sandbox.on("sulu.media-selection-overlay."+this.options.instanceName+".record-selected",function(a,b){var c=this.getData(),d=c.ids.indexOf(a);d>-1||(c.ids.push(a),this.setData(c,!1),this.addItem(b))}.bind(this)),this.sandbox.on("sulu.media-selection-overlay."+this.options.instanceName+".record-deselected",function(a){var b=this.getData(),c=b.ids.indexOf(a);c>-1&&b.ids.splice(c,1),this.setData(b,!1),this.removeItemById(a)}.bind(this)),this.sandbox.on("sulu.media-selection."+this.options.instanceName+".add-button-clicked",function(){this.sandbox.emit("sulu.media-selection-overlay."+this.options.instanceName+".set-selected",this.getData().ids),this.sandbox.emit("sulu.media-selection-overlay."+this.options.instanceName+".open")}.bind(this))},f=function(){this.sandbox.dom.on(this.$el,"click",function(a){var b=this.sandbox.dom.data(a.currentTarget,"id"),c=this.sandbox.dom.data(a.currentTarget,"collection");return this.sandbox.emit(this.options.navigateEvent,"media/collections/edit:"+c+"/files/edit:"+b),!1}.bind(this),"a.link")},g=function(){var a=this.sandbox.dom.createElement("<div/>");this.sandbox.dom.append(this.$el,a),this.sandbox.start([{name:"media-selection-overlay@sulumedia",options:{el:a,instanceName:this.options.instanceName,preSelectedIds:this.getData().ids,types:this.options.types}}])},h=function(a,b){var c=this.getData();for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);this.setData(c,b)};return{type:"itembox",initialize:function(){this.options=this.sandbox.util.extend(!0,{},a,this.options);var b=this.getData();this.options.ids={container:"media-selection-"+this.options.instanceName+"-container",addButton:"media-selection-"+this.options.instanceName+"-add",configButton:"media-selection-"+this.options.instanceName+"-config",displayOption:"media-selection-"+this.options.instanceName+"-display-option",content:"media-selection-"+this.options.instanceName+"-content",chooseTab:"media-selection-"+this.options.instanceName+"-choose-tab",uploadTab:"media-selection-"+this.options.instanceName+"-upload-tab",loader:"media-selection-"+this.options.instanceName+"-loader",collectionSelect:"media-selection-"+this.options.instanceName+"-collection-select",dropzone:"media-selection-"+this.options.instanceName+"-dropzone"},e.call(this),f.call(this),this.render(),b.displayOption&&this.setDisplayOption(b.displayOption),g.call(this)},isDataEmpty:function(a){return this.sandbox.util.isEmpty(a.ids)},getUrl:function(a){var b=-1===this.options.url.indexOf("?")?"?":"&";return[this.options.url,b,this.options.idsParameter,"=",(a.ids||[]).join(",")].join("")},getItemContent:function(a){return d.contentItem(a.id,a.collection,a.title,a.thumbnails)},sortHandler:function(a){var b=this.getData();b.ids=a,this.setData(b,!1)},removeHandler:function(a){for(var c=this.getData(),d=-1,e=c.ids.length;++d<e;)if(c.ids[d]===a){c.ids.splice(c.ids.indexOf(a),1);break}this.sandbox.emit(b.call(this),a),this.setData(c,!1)}}});